# 🎲 学生抽签系统 - 使用说明

## 系统架构

```
抽签程序/
├── lottery-backend/        # C# ASP.NET Core 后端
├── lottery-frontend/       # Vue 3 + TypeScript 前端
├── students.db            # SQLite 数据库
├── start-backend.bat      # 后端启动脚本
└── start-frontend.bat     # 前端启动脚本
```

## 快速启动

### 方法一：使用启动脚本（推荐）

1. **启动后端**
   - 双击运行 `start-backend.bat`
   - 等待看到 "Now listening on: http://localhost:5000"

2. **启动前端**
   - 双击运行 `start-frontend.bat`
   - 首次运行会自动安装依赖（需要几分钟）
   - 等待看到 "Local: http://localhost:5173"

3. **访问系统**
   - 在浏览器中打开 http://localhost:5173

### 方法二：手动启动

#### 启动后端
```bash
cd lottery-backend
dotnet run
```

#### 启动前端
```bash
cd lottery-frontend
npm install    # 首次运行需要
npm run dev
```

## 功能说明

### 1. 基本抽签
- 点击"开始抽签"按钮
- 系统会随机抽取一名学生
- 显示学生的详细信息（学号、姓名、性别、专业、班级）

### 2. 筛选抽签
- **性别筛选**：选择"男"或"女"，只从该性别的学生中抽取
- **班级筛选**：选择特定班级，只从该班级中抽取
- 可以同时使用两个筛选条件

### 3. 统计信息
- 页面顶部显示学生总人数
- 可以查看性别分布和班级分布

## 技术特性

### 后端 (C# ASP.NET Core)
- ✅ RESTful API 设计
- ✅ Entity Framework Core ORM
- ✅ SQLite 数据库
- ✅ CORS 跨域支持
- ✅ Swagger API 文档

### 前端 (Vue 3)
- ✅ TypeScript 类型安全
- ✅ 响应式设计
- ✅ 抽签动画效果
- ✅ 实时数据更新

## API 接口

后端提供以下 API 接口：

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/lottery/students` | GET | 获取所有学生列表 |
| `/api/lottery/students/{id}` | GET | 获取指定学生信息 |
| `/api/lottery/draw` | GET | 随机抽取学生 |
| `/api/lottery/stats` | GET | 获取统计信息 |

### 抽签接口参数

```
GET /api/lottery/draw?gender=男&className=25计科1班
```

- `gender` (可选): 性别筛选 ("男" 或 "女")
- `className` (可选): 班级筛选

## 数据库结构

SQLite 数据库 `students.db` 包含 `students` 表：

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INTEGER | 主键（自增） |
| serial_number | INTEGER | 序号 |
| student_id | TEXT | 学号 |
| name | TEXT | 姓名 |
| gender | TEXT | 性别 |
| major | TEXT | 专业 |
| class | TEXT | 班级 |

## 常见问题

### 1. 后端启动失败
- 确保已安装 .NET 8.0 SDK
- 检查 5000 端口是否被占用
- 确保 students.db 文件存在

### 2. 前端启动失败
- 确保已安装 Node.js (建议 v18+)
- 运行 `npm install` 安装依赖
- 检查 5173 端口是否被占用

### 3. 无法连接后端
- 确认后端已启动并运行在 http://localhost:5000
- 检查浏览器控制台是否有 CORS 错误
- 确认防火墙没有阻止连接

### 4. 抽签没有结果
- 检查是否有符合筛选条件的学生
- 查看浏览器控制台的错误信息
- 确认数据库中有数据

## 开发说明

### 修改后端端口
编辑 `lottery-backend/Properties/launchSettings.json`：
```json
{
  "applicationUrl": "http://localhost:你的端口"
}
```

### 修改前端 API 地址
编辑 `lottery-frontend/src/App.vue`：
```typescript
const API_BASE = 'http://localhost:你的端口/api/lottery'
```

## 系统要求

- Windows 操作系统
- .NET 8.0 SDK
- Node.js 18+ 和 npm
- 现代浏览器（Chrome、Edge、Firefox 等）

## 技术支持

如有问题，请检查：
1. 后端控制台输出
2. 前端浏览器控制台
3. 数据库文件是否存在且可访问
