# æµ‹è¯•å’Œéƒ¨ç½²æŒ‡å—

## ğŸ§ª æµ‹è¯•æŒ‡å—

### åç«¯æµ‹è¯•

#### 1. ç¼–è¯‘æµ‹è¯•
```bash
cd Kiro-ver/lottery-backend
dotnet build
```

**é¢„æœŸç»“æœ**ï¼š
```
âœ“ ç¼–è¯‘æˆåŠŸ
âœ“ æ— é”™è¯¯
```

#### 2. è¿è¡Œæµ‹è¯•
```bash
cd Kiro-ver/lottery-backend
dotnet run
```

**é¢„æœŸç»“æœ**ï¼š
```
info: Microsoft.Hosting.Lifetime[14]
      Now listening on: http://localhost:5000
```

#### 3. API æµ‹è¯•

**æ–¹å¼ä¸€ï¼šä½¿ç”¨ Swagger UI**
1. å¯åŠ¨åç«¯
2. è®¿é—® http://localhost:5000
3. åœ¨ Swagger UI ä¸­æµ‹è¯•å„ä¸ªæ¥å£

**æ–¹å¼äºŒï¼šä½¿ç”¨æµ‹è¯•è„šæœ¬**
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
./test-api.bat
```

**æ–¹å¼ä¸‰ï¼šæ‰‹åŠ¨æµ‹è¯•**
```bash
# æµ‹è¯•ç»Ÿè®¡æ¥å£
curl http://localhost:5000/api/lottery/stats

# æµ‹è¯•æŠ½ç­¾æ¥å£
curl http://localhost:5000/api/lottery/draw

# æµ‹è¯•æ€§åˆ«ç­›é€‰
curl "http://localhost:5000/api/lottery/draw?gender=ç”·"
```

### å‰ç«¯æµ‹è¯•

#### 1. å®‰è£…ä¾èµ–
```bash
cd Kiro-ver/lottery-frontend
pnpm install
```

#### 2. å¼€å‘æ¨¡å¼æµ‹è¯•
```bash
pnpm run dev
```

**é¢„æœŸç»“æœ**ï¼š
```
VITE v7.x.x  ready in xxx ms
âœ  Local:   http://localhost:5173/
```

#### 3. æ„å»ºæµ‹è¯•
```bash
pnpm run build
```

**é¢„æœŸç»“æœ**ï¼š
```
âœ“ 24 modules transformed.
dist/index.html                  0.46 kB
dist/assets/index-CPG3e-sj.css   6.21 kB
dist/assets/index-DovLcyj1.js   74.72 kB
âœ“ built in 554ms
```

#### 4. é¢„è§ˆæ„å»ºç»“æœ
```bash
pnpm run preview
```

### é›†æˆæµ‹è¯•

#### 1. å¯åŠ¨å®Œæ•´ç³»ç»Ÿ

**ç»ˆç«¯ 1 - åç«¯**ï¼š
```bash
cd Kiro-ver/lottery-backend
dotnet run
```

**ç»ˆç«¯ 2 - å‰ç«¯**ï¼š
```bash
cd Kiro-ver/lottery-frontend
pnpm run dev
```

#### 2. åŠŸèƒ½æµ‹è¯•æ¸…å•

- [ ] è®¿é—® http://localhost:5173
- [ ] é¡µé¢æ­£å¸¸æ˜¾ç¤º
- [ ] ç»Ÿè®¡ä¿¡æ¯æ­£ç¡®æ˜¾ç¤º
- [ ] ç­çº§åˆ—è¡¨æ­£ç¡®åŠ è½½
- [ ] æ— ç­›é€‰æ¡ä»¶æŠ½ç­¾æ­£å¸¸
- [ ] æ€§åˆ«ç­›é€‰æŠ½ç­¾æ­£å¸¸
- [ ] ç­çº§ç­›é€‰æŠ½ç­¾æ­£å¸¸
- [ ] ç»„åˆç­›é€‰æŠ½ç­¾æ­£å¸¸
- [ ] æŠ½ç­¾åŠ¨ç”»æµç•…
- [ ] ç»“æœæ˜¾ç¤ºæ­£ç¡®
- [ ] é”™è¯¯æç¤ºå‹å¥½

## ğŸš€ éƒ¨ç½²æŒ‡å—

### å¼€å‘ç¯å¢ƒéƒ¨ç½²

å·²å®Œæˆï¼Œä½¿ç”¨å¯åŠ¨è„šæœ¬å³å¯ï¼š
```bash
# åç«¯
./start-backend.bat

# å‰ç«¯
./start-frontend.bat
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

#### æ–¹æ¡ˆä¸€ï¼šWindows æœåŠ¡å™¨

**1. åç«¯éƒ¨ç½²**

```bash
# å‘å¸ƒåç«¯
cd Kiro-ver/lottery-backend
dotnet publish -c Release -o ./publish

# éƒ¨ç½²æ–‡ä»¶
# å°†ä»¥ä¸‹æ–‡ä»¶å¤åˆ¶åˆ°æœåŠ¡å™¨ï¼š
# - publish/ æ–‡ä»¶å¤¹
# - students.db æ•°æ®åº“æ–‡ä»¶
```

**è¿è¡Œåç«¯**ï¼š
```bash
cd publish
dotnet lottery-backend.dll
```

**é…ç½®ä¸º Windows æœåŠ¡**ï¼ˆå¯é€‰ï¼‰ï¼š
```bash
# ä½¿ç”¨ NSSM æˆ– sc.exe åˆ›å»ºæœåŠ¡
sc create LotteryBackend binPath="C:\path\to\publish\lottery-backend.exe"
sc start LotteryBackend
```

**2. å‰ç«¯éƒ¨ç½²**

```bash
# æ„å»ºå‰ç«¯
cd Kiro-ver/lottery-frontend
pnpm run build

# éƒ¨ç½²æ–‡ä»¶
# å°† dist/ æ–‡ä»¶å¤¹å†…å®¹å¤åˆ¶åˆ° Web æœåŠ¡å™¨
```

**IIS éƒ¨ç½²**ï¼š
1. åˆ›å»ºæ–°ç½‘ç«™
2. ç‰©ç†è·¯å¾„æŒ‡å‘ dist æ–‡ä»¶å¤¹
3. ç»‘å®šç«¯å£ï¼ˆå¦‚ 80ï¼‰
4. é…ç½® URL é‡å†™ï¼ˆå¦‚éœ€è¦ï¼‰

**Nginx éƒ¨ç½²**ï¼š
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    root /path/to/dist;
    index index.html;
    
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # ä»£ç†åç«¯ API
    location /api {
        proxy_pass http://localhost:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

#### æ–¹æ¡ˆäºŒï¼šDocker éƒ¨ç½²

**1. åˆ›å»º Dockerfileï¼ˆåç«¯ï¼‰**

```dockerfile
# Kiro-ver/lottery-backend/Dockerfile
FROM mcr.microsoft.com/dotnet/aspnet:8.0 AS base
WORKDIR /app
EXPOSE 5000

FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /src
COPY ["lottery-backend.csproj", "./"]
RUN dotnet restore
COPY . .
RUN dotnet build -c Release -o /app/build

FROM build AS publish
RUN dotnet publish -c Release -o /app/publish

FROM base AS final
WORKDIR /app
COPY --from=publish /app/publish .
COPY ../students.db .
ENV ASPNETCORE_URLS=http://+:5000
ENTRYPOINT ["dotnet", "lottery-backend.dll"]
```

**2. åˆ›å»º Dockerfileï¼ˆå‰ç«¯ï¼‰**

```dockerfile
# Kiro-ver/lottery-frontend/Dockerfile
FROM node:18 AS build
WORKDIR /app
COPY package*.json ./
RUN npm install -g pnpm
RUN pnpm install
COPY . .
RUN pnpm run build

FROM nginx:alpine
COPY --from=build /app/dist /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

**3. Docker Compose**

```yaml
# Kiro-ver/docker-compose.yml
version: '3.8'

services:
  backend:
    build: ./lottery-backend
    ports:
      - "5000:5000"
    volumes:
      - ./students.db:/app/students.db
    environment:
      - ASPNETCORE_ENVIRONMENT=Production

  frontend:
    build: ./lottery-frontend
    ports:
      - "80:80"
    depends_on:
      - backend
```

**è¿è¡Œ**ï¼š
```bash
docker-compose up -d
```

### é…ç½®ä¿®æ”¹

#### ç”Ÿäº§ç¯å¢ƒé…ç½®

**åç«¯ - appsettings.Production.json**ï¼š
```json
{
  "Logging": {
    "LogLevel": {
      "Default": "Warning",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*",
  "ConnectionStrings": {
    "DefaultConnection": "Data Source=./students.db"
  }
}
```

**å‰ç«¯ - ä¿®æ”¹ API åœ°å€**ï¼š
```typescript
// src/api/lottery.ts
const API_BASE = import.meta.env.PROD 
  ? 'https://your-domain.com/api/lottery'  // ç”Ÿäº§ç¯å¢ƒ
  : 'http://localhost:5000/api/lottery';   // å¼€å‘ç¯å¢ƒ
```

**åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶**ï¼š
```bash
# .env.production
VITE_API_BASE_URL=https://your-domain.com/api/lottery
```

```typescript
// ä½¿ç”¨ç¯å¢ƒå˜é‡
const API_BASE = import.meta.env.VITE_API_BASE_URL || 'http://localhost:5000/api/lottery';
```

## ğŸ”’ å®‰å…¨é…ç½®

### ç”Ÿäº§ç¯å¢ƒ CORS

```csharp
// Program.cs
builder.Services.AddCors(options =>
{
    options.AddPolicy("Production", policy =>
    {
        policy.WithOrigins("https://your-domain.com")
              .AllowAnyHeader()
              .AllowAnyMethod();
    });
});

// ä½¿ç”¨
app.UseCors(app.Environment.IsDevelopment() ? "AllowVue" : "Production");
```

### HTTPS é…ç½®

```csharp
// Program.cs
if (!app.Environment.IsDevelopment())
{
    app.UseHttpsRedirection();
}
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### åç«¯ä¼˜åŒ–

1. **å¯ç”¨å“åº”å‹ç¼©**
```csharp
builder.Services.AddResponseCompression();
app.UseResponseCompression();
```

2. **æ·»åŠ å“åº”ç¼“å­˜**
```csharp
builder.Services.AddResponseCaching();
app.UseResponseCaching();
```

### å‰ç«¯ä¼˜åŒ–

1. **å¯ç”¨ Gzip å‹ç¼©**ï¼ˆNginxï¼‰
```nginx
gzip on;
gzip_types text/plain text/css application/json application/javascript;
```

2. **é…ç½®ç¼“å­˜**ï¼ˆNginxï¼‰
```nginx
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}
```

## ğŸ” ç›‘æ§å’Œæ—¥å¿—

### åç«¯æ—¥å¿—

æŸ¥çœ‹æ—¥å¿—ï¼š
```bash
# å¼€å‘ç¯å¢ƒ
# æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°

# ç”Ÿäº§ç¯å¢ƒ
# é…ç½®æ—¥å¿—æ–‡ä»¶
```

### å‰ç«¯é”™è¯¯ç›‘æ§

é›†æˆ Sentry æˆ–å…¶ä»–é”™è¯¯è¿½è¸ªæœåŠ¡ã€‚

## ğŸ§¹ ç»´æŠ¤

### æ•°æ®åº“å¤‡ä»½

```bash
# å¤‡ä»½æ•°æ®åº“
copy students.db backup/students_20251206.db

# å®šæœŸå¤‡ä»½è„šæœ¬
# åˆ›å»º backup.bat
```

### æ›´æ–°éƒ¨ç½²

```bash
# åç«¯æ›´æ–°
cd Kiro-ver/lottery-backend
git pull
dotnet publish -c Release -o ./publish
# é‡å¯æœåŠ¡

# å‰ç«¯æ›´æ–°
cd Kiro-ver/lottery-frontend
git pull
pnpm install
pnpm run build
# æ›´æ–° Web æœåŠ¡å™¨æ–‡ä»¶
```

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰

- [ ] ä»£ç å·²æäº¤åˆ° Git
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] é…ç½®æ–‡ä»¶å·²æ›´æ–°
- [ ] æ•°æ®åº“å·²å¤‡ä»½
- [ ] API åœ°å€å·²é…ç½®
- [ ] CORS å·²é…ç½®

### éƒ¨ç½²å

- [ ] åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] å‰ç«¯é¡µé¢å¯è®¿é—®
- [ ] API æ¥å£æ­£å¸¸
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] æ—¥å¿—è®°å½•æ­£å¸¸
- [ ] æ€§èƒ½ç›‘æ§æ­£å¸¸

## ğŸ“ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **åç«¯æ— æ³•å¯åŠ¨**
   - æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
   - æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶è·¯å¾„
   - æŸ¥çœ‹é”™è¯¯æ—¥å¿—

2. **å‰ç«¯æ— æ³•è¿æ¥åç«¯**
   - æ£€æŸ¥ API åœ°å€é…ç½®
   - æ£€æŸ¥ CORS é…ç½®
   - æ£€æŸ¥ç½‘ç»œè¿æ¥

3. **æ•°æ®åº“é”™è¯¯**
   - æ£€æŸ¥æ–‡ä»¶æƒé™
   - æ£€æŸ¥æ–‡ä»¶è·¯å¾„
   - æ£€æŸ¥æ•°æ®åº“å®Œæ•´æ€§

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**æœ€åæ›´æ–°**ï¼š2025-12-06
